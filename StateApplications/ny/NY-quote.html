<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get a Quote - New York DBL & PFL - ShelterPoint</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        .quote-display {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            bottom: 0;
            width: calc(100% - 2rem);
            max-width: 800px; /* Match container max width */
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1rem 1.25rem;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 -6px 24px rgba(0, 59, 92, 0.25);
            margin: 0 auto;
            z-index: 1000;
        }
        main {
            padding-bottom: 180px; /* prevent content from being hidden behind the fixed quote box */
        }
        .quote-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 1rem;
            align-items: center;
        }
        .quote-left {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        /* .quote-right intentionally left minimal; inherits styles */
        
        .quote-display h3 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .quote-amount {
            font-size: 2rem;
            font-weight: 700;
            margin: 1rem 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .quote-breakdown {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .quote-breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .quote-breakdown-item:last-child {
            border-bottom: none;
            font-weight: 600;
            margin-top: 0.5rem;
            padding-top: 1rem;
            border-top: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .quote-period {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }
        /* Checkbox buttons */
        .checkbox-item input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        .checkbox-item label {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.6rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-light);
            color: var(--text-dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            width: 120px; /* unified button width */
            height: 44px; /* unified button height */
        }
        .checkbox-item label:hover {
            border-color: var(--accent-color);
            background: #E8F4F8;
        }
        .checkbox-item input[type="checkbox"]:checked + label {
            background: var(--accent-color);
            color: #fff;
            border-color: var(--accent-color);
            box-shadow: 0 4px 10px rgba(0, 164, 228, 0.25);
        }
        .checkbox-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        .checkbox-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .checkbox-item .help-text {
            margin-top: 0.4rem; /* spacing between button and helper text */
            text-align: center;
        }
        .checkbox-item.wide-button label {
            width: 180px; /* wider buttons for optional benefits */
        }
        
        /* Radio button buttons */
        .radio-item input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        .radio-item label {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.6rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-light);
            color: var(--text-dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            text-align: center;
            width: 120px; /* unified button width */
            height: 44px; /* unified button height */
        }
        .radio-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .radio-item .help-text {
            margin-top: 0.4rem; /* spacing between button and helper text */
        }
        .radio-item label:hover {
            border-color: var(--accent-color);
            background: #E8F4F8;
        }
        .radio-item input[type="radio"]:checked + label {
            background: var(--accent-color);
            color: #fff;
            border-color: var(--accent-color);
            box-shadow: 0 4px 10px rgba(0, 164, 228, 0.25);
        }
        .radio-group.button-style {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        /* Centered 3-column grid for DBL benefits */
        .radio-group.button-style.benefit-grid {
            display: grid;
            grid-template-columns: repeat(3, auto);
            justify-content: center;
            justify-items: center;
            gap: 0.75rem;
        }
        /* Wider, centered billing options in two columns */
        .radio-group.button-style.billing-options {
            display: grid;
            grid-template-columns: repeat(2, auto);
            justify-content: center;
            justify-items: center;
            gap: 10rem;
        }
        .radio-group.button-style.billing-options .radio-item label {
            width: 200px; /* wider buttons for billing options */
        }
        .radio-group.button-style.billing-options .radio-item .help-text {
            text-align: center;
        }
        
        .form-grid {
            display: block;
        }
        
        @media (max-width: 1024px) {
            .form-grid {
                display: block;
            }
            .quote-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="../assets/images/ShelterPoint.jpg" alt="ShelterPoint Life Insurance Company" style="height: 50px;">
                <p class="tagline">New York DBL & PFL Quote</p>
            </div>
        </header>

        <main>
            <div class="form-section">
                <h2 class="section-title">Get Your DBL & PFL Quote</h2>
                <p class="section-description">Fill out the information below to receive a real-time quote for your NY Statutory Disability Benefits (DBL) & Paid Family Leave Benefits (PFL) coverage.</p>

                <div class="form-grid">
                    <div>
                        <form id="quoteForm">
                            <!-- Full Legal Business Name -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <div class="form-group">
                                    <label for="businessName">Full Legal Business Name <span class="required">*</span></label>
                                    <input type="text" id="businessName" name="businessName" required>
                                    <span class="help-text">As filed with the NY State Department of Labor</span>
                                </div>
                            </div>

                            <!-- Effective Date -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Effective Date</h3>
                                
                                <div class="form-group">
                                    <label for="effectiveDate">Requested Effective Date <span class="required">*</span></label>
                                    <input type="date" id="effectiveDate" name="effectiveDate" required>
                                </div>
                            </div>

                            <!-- Employee Count -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Covered Employees</h3>
                                
                                <div class="form-row" style="margin-top: 1rem;">
                                    <div class="form-group">
                                        <label for="coveredMales">Number of Covered Males</label>
                                        <input type="number" id="coveredMales" name="coveredMales" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="coveredFemales">Number of Covered Females</label>
                                        <input type="number" id="coveredFemales" name="coveredFemales" min="0" value="0">
                                    </div>
                                </div>
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label for="totalEmployees">Total Employees</label>
                                    <input type="number" id="totalEmployees" name="totalEmployees" min="0" readonly>
                                    <div id="headcountWarning" style="display: none; background: #FFF3CD; color: #856404; padding: 0.75rem; border-radius: 6px; margin-top: 0.5rem; border-left: 4px solid #FFC107;">
                                        <strong>‚ö†Ô∏è Notice:</strong> Manual underwriting is necessary for headcounts over 49.
                                    </div>
                                </div>
                            </div>

                            <!-- PFL Premium Calculation -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">PFL Premium</h3>
                                <p style="color: var(--text-light); margin-bottom: 1rem; font-size: 0.9rem;">NY State Average Weekly Wage (NYSAWW): $95,348.76 per year</p>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="employeesOverNYSAWW">Number of Employees Over NYSAWW</label>
                                        <input type="number" id="employeesOverNYSAWW" name="employeesOverNYSAWW" min="0" value="0" placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="payrollBelowNYSAWW">Total Annual Payroll Below NYSAWW</label>
                                        <input type="text" id="payrollBelowNYSAWW" name="payrollBelowNYSAWW" value="0" placeholder="$0.00" inputmode="decimal" pattern="^[0-9]*\.?[0-9]*$" aria-label="Total Annual Payroll Below NYSAWW">
                                    </div>
                                </div>
                                
                            </div>

                            <!-- DBL and PFL Benefits -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">DBL Benefits <span class="required">*</span></h3>
                                <p style="color: var(--text-light); margin-bottom: 1rem;">Select your benefit level for DBL</p>
                                
                                <div class="checkbox-group" style="justify-content: center; display: grid; grid-template-columns: repeat(3, auto); gap: 0.75rem;">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="statutory" name="dblBenefits" value="statutory" onchange="handleDBLSelection(this)">
                                        <label for="statutory">1x</label>
                                        <div class="help-text" style="text-align: center; margin-top: 0.25rem;">Maximum Benefit: $170/week</div>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enriched1.5x" name="dblBenefits" value="enriched1.5x" onchange="handleDBLSelection(this)">
                                        <label for="enriched1.5x">1.5x</label>
                                        <div class="help-text" style="text-align: center; margin-top: 0.25rem;">Maximum Benefit: $255/week</div>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enriched2x" name="dblBenefits" value="enriched2x" onchange="handleDBLSelection(this)">
                                        <label for="enriched2x">2x</label>
                                        <div class="help-text" style="text-align: center; margin-top: 0.25rem;">Maximum Benefit: $340/week</div>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enriched3x" name="dblBenefits" value="enriched3x" onchange="handleDBLSelection(this)">
                                        <label for="enriched3x">3x</label>
                                        <div class="help-text" style="text-align: center; margin-top: 0.25rem;">Maximum Benefit: $510/week</div>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enriched4x" name="dblBenefits" value="enriched4x" onchange="handleDBLSelection(this)">
                                        <label for="enriched4x">4x</label>
                                        <div class="help-text" style="text-align: center; margin-top: 0.25rem;">Maximum Benefit: $680/week</div>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="enriched5x" name="dblBenefits" value="enriched5x" onchange="handleDBLSelection(this)">
                                        <label for="enriched5x">5x</label>
                                        <div class="help-text" style="text-align: center; margin-top: 0.25rem;">Maximum Benefit: $850/week</div>
                                    </div>
                                </div>

                                <div class="info-box" style="margin-top: 1rem;">
                                    <p><strong>Note:</strong> All DBL benefit options include statutory PFL benefits</p>
                                </div>
                            </div>

                            <!-- Optional Riders -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Optional Riders</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>In-Hospital Rider</label>
                                        <div class="help-text" style="margin: 0.25rem 0 0.6rem 0;">
                                            Increase the maximum benefit by $170/week during hospital confinement
                                        </div>
                                        <div class="checkbox-item" style="align-items: flex-start;">
                                            <input type="checkbox" id="inHospitalRider" name="inHospitalRider">
                                            <label for="inHospitalRider">Add Rider</label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>AD&D Benefit Rider</label>
                                        <div class="help-text" style="margin: 0.25rem 0 0.6rem 0;">
                                            Add Accidental Death & Dismemberment coverage with a $50k or $100k benefit
                                        </div>
                                        <div class="checkbox-group">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="add50k" name="addBenefit" value="50000" onchange="handleADnDSelection(this)">
                                                <label for="add50k">$50k</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="add100k" name="addBenefit" value="100000" onchange="handleADnDSelection(this)">
                                                <label for="add100k">$100k</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Optional BaseLine Benefits -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Optional BaseLine Benefits & Non-Insurance Benefits</h3>
                                
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <div class="checkbox-item wide-button">
                                            <input type="checkbox" id="termLife15k" name="termLife15k">
                                            <label for="termLife15k">Term Life $15k</label>
                                            <div class="help-text">$15,000 term life insurance coverage</div>
                                            <div class="help-text" style="font-weight: 600; color: var(--primary-color); margin-top: 0.25rem;">$36/year per person</div>
                                        </div>
                                        <div class="checkbox-item wide-button">
                                            <input type="checkbox" id="eap" name="eap">
                                            <label for="eap">EAP</label>
                                            <div class="help-text">24/7 access to TELUS Health EAP services</div>
                                            <div class="help-text" style="font-weight: 600; color: var(--primary-color); margin-top: 0.25rem;">$36/year per person</div>
                                        </div>
                                        <div class="checkbox-item wide-button">
                                            <input type="checkbox" id="nurseHelpline" name="nurseHelpline">
                                            <label for="nurseHelpline">Nurse Helpline</label>
                                            <div class="help-text">24/7 access to registered nurses</div>
                                            <div class="help-text" style="font-weight: 600; color: var(--primary-color); margin-top: 0.25rem;">$54/year per person</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Billing Options -->
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Billing Options <span class="required">*</span></h3>
                                <p style="color: var(--text-light); margin-bottom: 1rem;">Make one selection from the options below</p>
                                
                                <div class="checkbox-group" style="display: grid; grid-template-columns: repeat(2, auto); justify-content: center; justify-items: center; gap: 10rem;">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="annualBilling" name="billingOption" value="annual" onchange="handleBillingSelection(this)">
                                        <label for="annualBilling" style="width: 200px;">Annually</label>
                                        <div class="help-text" style="text-align: center;">Minimum DBL Premium is $125.00 annually</div>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="quarterlyBilling" name="billingOption" value="quarterly" onchange="handleBillingSelection(this)">
                                        <label for="quarterlyBilling" style="width: 200px;">Quarterly</label>
                                        <div class="help-text" style="text-align: center;">Minimum $35.00 per quarter. A quarterly installment fee may apply. 11 or more lives required.</div>
                                    </div>
                                </div>

                                <div id="payrollFields" style="display: none; margin-top: 1.5rem;">
                                    <div class="alert-box">
                                        <strong>üí° Payroll Information</strong>
                                        <p>Please provide monthly covered payroll amounts</p>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="payrollFemales">Monthly Covered Payroll - Females</label>
                                            <input type="number" id="payrollFemales" name="payrollFemales" placeholder="$" min="0" step="0.01">
                                        </div>
                                        <div class="form-group">
                                            <label for="payrollMales">Monthly Covered Payroll - Males</label>
                                            <input type="number" id="payrollMales" name="payrollMales" placeholder="$" min="0" step="0.01">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="totalPayroll">Total Monthly Covered Payroll</label>
                                        <input type="number" id="totalPayroll" name="totalPayroll" placeholder="$" min="0" step="0.01" readonly>
                                    </div>
                                </div>
                            </div>

                            <div class="help-section" style="margin-top: 2rem;">
                                <p>Need help? Call our Sales Team at <strong>800-365-4999</strong></p>
                                <p>Or email: <a href="mailto:sales@shelterpoint.com">sales@shelterpoint.com</a></p>
                            </div>

                            <div class="button-group">
                            </div>
                        </form>
                    </div>

                    <!-- Spacer to prevent content being hidden behind bottom quote box -->
                    <!-- Quote Display (fixed at bottom) -->
                    <div class="quote-display">
                        <div class="quote-content">
                            <div class="quote-left">
                                <h3>Your Quote</h3>
                                <div class="quote-amount" id="quoteAmount">$0.00</div>
                                <div class="quote-period" id="quotePeriod">per year</div>
                            </div>
                            <div class="quote-right">
                                <div class="quote-breakdown" id="quoteBreakdown">
                                    <div class="quote-breakdown-item">
                                        <span>DBL Premium:</span>
                                        <span id="dblPremium">$0.00</span>
                                    </div>
                                    <div class="quote-breakdown-item">
                                        <span>PFL Premium:</span>
                                        <span id="pflPremium">$0.00</span>
                                    </div>
                                    <div class="quote-breakdown-item">
                                        <span>Optional Benefits:</span>
                                        <span id="optionalCost">$0.00</span>
                                    </div>
                                    <div class="quote-breakdown-item">
                                        <span>Total:</span>
                                        <span id="totalCost">$0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="button-group" style="margin-top: 1rem; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <button type="button" class="btn-secondary" onclick="window.location.href='../index.html'" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.borderColor='rgba(255,255,255,0.5)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.borderColor='rgba(255,255,255,0.3)'; this.style.transform='translateY(0)'" style="background: rgba(255,255,255,0.2); color: white; border-color: rgba(255,255,255,0.3); margin-right: auto; transition: all 0.3s ease;">‚Üê Back</button>
                            <button type="button" onclick="saveQuote()" onmouseover="this.style.background='rgba(0, 170, 85, 1)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0, 170, 85, 0.3)'" onmouseout="this.style.background='rgba(0, 170, 85, 0.9)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'" style="background: rgba(0, 170, 85, 0.9); color: white; border: 2px solid rgba(0, 170, 85, 0.9); padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 0 auto;">Save Quote</button>
                            <button type="button" class="btn-primary" onclick="continueToApplication()" onmouseover="this.style.background='#f0f0f0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)'" onmouseout="this.style.background='white'; this.style.transform='translateY(0)'; this.style.boxShadow='none'" style="background: white; color: var(--primary-color); border-color: white; margin-left: auto; transition: all 0.3s ease;">Continue to Application ‚Üí</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>¬© 2025 ShelterPoint Life Insurance Company</p>
        </footer>
    </div>

    <script src="quote-calculator.js"></script>
    <script>

        // Calculate total employees
        document.getElementById('coveredMales').addEventListener('input', updateQuote);
        document.getElementById('coveredFemales').addEventListener('input', updateQuote);

        function calculateTotal() {
            const males = parseInt(document.getElementById('coveredMales').value) || 0;
            const females = parseInt(document.getElementById('coveredFemales').value) || 0;
            const total = males + females;
            document.getElementById('totalEmployees').value = total;
            
            // Show/hide headcount warning for NY
            const HEADCOUNT_CAP = 50;
            const warningEl = document.getElementById('headcountWarning');
            if (warningEl) {
                if (total >= HEADCOUNT_CAP) {
                    warningEl.style.display = 'block';
                } else {
                    warningEl.style.display = 'none';
                }
            }
            
            return total;
        }

        // Calculate payroll totals
        document.getElementById('payrollMales').addEventListener('input', calculatePayrollTotal);
        document.getElementById('payrollFemales').addEventListener('input', calculatePayrollTotal);

        function calculatePayrollTotal() {
            const males = parseFloat(document.getElementById('payrollMales').value) || 0;
            const females = parseFloat(document.getElementById('payrollFemales').value) || 0;
            document.getElementById('totalPayroll').value = (males + females).toFixed(2);
            updateQuote();
        }

        // Handle DBL Benefits selection - only one can be selected at a time
        function handleDBLSelection(selectedCheckbox) {
            const allDBL = document.querySelectorAll('input[name="dblBenefits"]');
            allDBL.forEach(cb => {
                if (cb !== selectedCheckbox) {
                    cb.checked = false;
                }
            });
            updateQuote();
        }

        // Handle AD&D Benefit selection - only one can be selected at a time
        function handleADnDSelection(selectedCheckbox) {
            const allADnD = document.querySelectorAll('input[name="addBenefit"]');
            allADnD.forEach(cb => {
                if (cb !== selectedCheckbox) {
                    cb.checked = false;
                }
            });
            updateQuote();
        }

        // Handle Billing Options selection - only one can be selected at a time
        function handleBillingSelection(selectedCheckbox) {
            const allBilling = document.querySelectorAll('input[name="billingOption"]');
            allBilling.forEach(cb => {
                if (cb !== selectedCheckbox) {
                    cb.checked = false;
                }
            });
            toggleBillingFields();
            updateQuote();
        }

        // Toggle billing fields
        function toggleBillingFields() {
            const payrollFields = document.getElementById('payrollFields');
            // Payroll fields are no longer used
            payrollFields.style.display = 'none';
            updateQuote();
        }

        // Add event listeners for all quote-affecting fields
        document.querySelectorAll('input[type="radio"], input[type="checkbox"], input[type="number"]').forEach(input => {
            input.addEventListener('change', updateQuote);
            input.addEventListener('input', updateQuote);
        });
        
        // Special listeners for PFL fields
        document.getElementById('employeesOverNYSAWW').addEventListener('input', updateQuote);
        document.getElementById('payrollBelowNYSAWW').addEventListener('input', updateQuote);

        // Currency formatting for NY payrollBelowNYSAWW and safe parsing
        const nyCleanNumber = (v)=> parseFloat(String(v||'').replace(/[^0-9.]/g,'')) || 0;
        (function(){
            const payrollBelowNY = document.getElementById('payrollBelowNYSAWW');
            if (!payrollBelowNY) return;
            const fmt = (n)=> new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(n);
            const sanitize = (v)=>{
                // allow only digits and a single decimal point
                v = String(v||'');
                v = v.replace(/[^0-9.]/g, '');
                const parts = v.split('.');
                if (parts.length > 2) v = parts[0] + '.' + parts.slice(1).join('');
                return v;
            };
            payrollBelowNY.addEventListener('input', ()=>{
                const clean = sanitize(payrollBelowNY.value);
                if (clean !== payrollBelowNY.value) payrollBelowNY.value = clean;
            });
            payrollBelowNY.addEventListener('focus', ()=>{ payrollBelowNY.value = String(payrollBelowNY.value||'').replace(/[^0-9.]/g,''); });
            payrollBelowNY.addEventListener('blur', ()=>{ payrollBelowNY.value = fmt(nyCleanNumber(payrollBelowNY.value)); });
        })();

        // Update quote calculation
        function updateQuote() {
            // Calculate total employees first
            const totalEmployees = calculateTotal();
            
            // Check headcount cap - don't calculate quote if exceeds cap
            const HEADCOUNT_CAP = 50;
            if (totalEmployees >= HEADCOUNT_CAP) {
                document.getElementById('quoteAmount').textContent = 'N/A';
                document.getElementById('quotePeriod').textContent = '';
                // Clear breakdown values
                const breakdownElements = ['dblPremium', 'pflPremium', 'optionalCost'];
                breakdownElements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = 'N/A';
                });
                return;
            }
            
            // Collect form data
            const formData = new FormData(document.getElementById('quoteForm'));
            const quoteParams = {};
            formData.forEach((value, key) => {
                quoteParams[key] = value;
            });
            
            // Map inputs to calculator format
            // Employee counts - use gender-specific counts
            quoteParams.maleEmployees = parseInt(document.getElementById('coveredMales').value) || 0;
            quoteParams.femaleEmployees = parseInt(document.getElementById('coveredFemales').value) || 0;
            
            // PFL calculation inputs
            quoteParams.employeesOverNYSAWW = parseInt(document.getElementById('employeesOverNYSAWW').value) || 0;
            quoteParams.payrollBelowNYSAWW = nyCleanNumber(document.getElementById('payrollBelowNYSAWW').value);
            
            // DBL benefit tier
            const dblBenefits = document.querySelector('input[name="dblBenefits"]:checked');
            quoteParams.dblBenefits = dblBenefits ? dblBenefits.value : 'statutory';
            
            // Billing option
            const billingOption = document.querySelector('input[name="billingOption"]:checked');
            quoteParams.billingOption = billingOption ? billingOption.value : 'annual';
            
            // In-Hospital rider (affects DBL rates)
            quoteParams.inHospitalRider = document.getElementById('inHospitalRider').checked;
            
            // AD&D benefit
            const adddBenefit = document.querySelector('input[name="addBenefit"]:checked');
            quoteParams.adddBenefit = adddBenefit ? adddBenefit.value : null;
            
            // Optional benefits
            quoteParams.termLife15k = document.getElementById('termLife15k').checked;
            quoteParams.eap = document.getElementById('eap').checked;
            quoteParams.nurseHelpline = document.getElementById('nurseHelpline').checked;
            
            // Calculate quote using the calculator module
            const quote = calculateQuote(quoteParams);
            
            // Update display with formatted values
            document.getElementById('quoteAmount').textContent = formatCurrency(quote.displayAmount);
            document.getElementById('quotePeriod').textContent = 'per ' + quote.billingPeriod;
            document.getElementById('dblPremium').textContent = formatCurrency(quote.breakdown.dblPremium);
            document.getElementById('pflPremium').textContent = formatCurrency(quote.breakdown.pflPremium);
            document.getElementById('optionalCost').textContent = formatCurrency(quote.breakdown.optionalCost);
            document.getElementById('totalCost').textContent = formatCurrency(quote.breakdown.totalCost);
        }

        // Continue to application
        function continueToApplication() {
            // Store quote data in sessionStorage to pass to application
            const formData = new FormData(document.getElementById('quoteForm'));
            const quoteData = {};
            formData.forEach((value, key) => {
                quoteData[key] = value;
            });
            
            // Add calculated values
            quoteData.totalEmployees = document.getElementById('totalEmployees').value;
            quoteData.coveredMales = document.getElementById('coveredMales').value;
            quoteData.coveredFemales = document.getElementById('coveredFemales').value;
            quoteData.totalPayroll = document.getElementById('totalPayroll').value || '';
            quoteData.employeesOverNYSAWW = document.getElementById('employeesOverNYSAWW').value || '0';
            quoteData.payrollBelowNYSAWW = document.getElementById('payrollBelowNYSAWW').value || '0';
            quoteData.finalQuote = document.getElementById('totalCost').textContent;
            
            // Get the quote object for detailed breakdown
            const quoteParams = {
                maleEmployees: parseInt(quoteData.coveredMales) || 0,
                femaleEmployees: parseInt(quoteData.coveredFemales) || 0,
                employeesOverNYSAWW: parseInt(quoteData.employeesOverNYSAWW) || 0,
                payrollBelowNYSAWW: parseFloat(quoteData.payrollBelowNYSAWW) || 0,
                dblBenefits: quoteData.dblBenefits || 'statutory',
                billingOption: quoteData.billingOption || 'annual',
                inHospitalRider: document.getElementById('inHospitalRider').checked,
                adddBenefit: quoteData.addBenefit || null,
                termLife15k: document.getElementById('termLife15k').checked,
                eap: document.getElementById('eap').checked,
                nurseHelpline: document.getElementById('nurseHelpline').checked
            };
            const quote = calculateQuote(quoteParams);
            
            // Store complete quote information
            quoteData.quoteBreakdown = quote;
            
            sessionStorage.setItem('quoteData', JSON.stringify(quoteData));
            
            // Navigate to multi-step application
            window.location.href = 'NY-app-requirements.html';
        }

        function saveQuote(){
            const formData = new FormData(document.getElementById('quoteForm'));
            const quoteData = {};
            formData.forEach((value, key) => {
                quoteData[key] = value;
            });
            
            quoteData.totalEmployees = document.getElementById('totalEmployees').value;
            quoteData.coveredMales = document.getElementById('coveredMales').value;
            quoteData.coveredFemales = document.getElementById('coveredFemales').value;
            quoteData.totalPayroll = document.getElementById('totalPayroll').value || '';
            quoteData.employeesOverNYSAWW = document.getElementById('employeesOverNYSAWW').value || '0';
            quoteData.payrollBelowNYSAWW = document.getElementById('payrollBelowNYSAWW').value || '0';
            quoteData.finalQuote = document.getElementById('totalCost').textContent;
            quoteData.quoteAmount = document.getElementById('quoteAmount').textContent;
            quoteData.quotePeriod = document.getElementById('quotePeriod').textContent;
            
            localStorage.setItem('nySavedQuote', JSON.stringify(quoteData));
            document.getElementById('saveQuoteModal').classList.add('active');
        }

        function closeSaveQuoteModal(){
            document.getElementById('saveQuoteModal').classList.remove('active');
        }

        function downloadQuotePDF(){
            // Placeholder for PDF download functionality
            console.log('Download PDF functionality would go here');
        }

        function sendQuoteEmail(){
            const email = document.getElementById('quoteEmailInput').value;
            // Placeholder for email sending functionality
            console.log('Send quote to email:', email);
        }

        // Initialize quote on page load
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('effectiveDate').value = '2026-01-01';
            updateQuote();
        });
    </script>

    <!-- Save Quote Modal -->
    <div id="saveQuoteModal" class="modal-overlay" onclick="if(event.target === this) closeSaveQuoteModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Save Quote</h3>
            </div>
            <div class="modal-body">
                <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
                    <p style="margin: 0; color: #2e7d32; font-weight: 500; text-align: center;">Quote Saved Successfully!</p>
                </div>
                <p style="margin: 0 0 1.5rem 0; color: var(--text-color); font-size: 0.9rem; text-align: center;">Copy the Quote ID below to save time when applying for a corresponding policy</p>
                <div class="quote-id-display">
                    <label>Quote ID</label>
                    <div class="quote-id-value">123456789</div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-primary" onclick="downloadQuotePDF()">Download PDF</button>
                    <div class="form-group">
                        <label for="quoteEmailInput">Email Address</label>
                        <input type="email" id="quoteEmailInput" placeholder="Enter email address">
                    </div>
                    <div class="modal-buttons">
                        <button type="button" class="btn-primary" onclick="sendQuoteEmail()">Send Quote</button>
                        <button type="button" class="btn-secondary" onclick="closeSaveQuoteModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

